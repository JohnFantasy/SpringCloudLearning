# 深入理解JVM

# 一、如何学习（方法论）

## 1、学习方法（思想）

- 如何更好更有效率的学习一门技术、一门知识
- 输入：看视频、看书
- 输出：做项目、记笔记、写博客、微信公众号、给别人讲（项目团队分享等）
- 学习JVM是一个任重而道远的过程
- JVM并不是只有Oracle提供的HotSpot，IBM也有

## 2、课程大纲

- JVM介绍
- HotSpot虚拟机讲解
- 垃圾收集方式详解
- 垃圾收集算法详解
- 垃圾收集器详解
- 分代垃圾收集机制详解
- 新生代讲解
- 老年代详解
- G1收集器详解与实例
- 常见且重要虚拟机参数实例
- 栈
- 方法区
- 线程共享内存区
- 根搜索算法
- Serial收集器
- ParNew收集器
- 类加载机制详解
- 类加载的双亲委派机制
- 字节码文件的生成与分析
- 魔数
- 常量池与方法表
- 各种指令详解
- 锁详解
- 线程安全
- 偏向锁、自旋锁与轻量锁
- JIT编译器
- GC日志生成与分析
- 虚拟机监控工具详解
- jConsole使用方式详解
- 何为逃逸与逃逸分析
- 方法内联
- 虚拟机内存模型详解（MemoryModel）

# 二、类加载

## 1、什么是类加载？ClassLoading
- 1.在Java代码中，类型的加载、连接与初始化都是在程序运行期间完成的。
	- 加载
最常见：将class文件从磁盘加载至内存中
		- 查找并加载类的二进制数据
	- 连接
将类与类之间的关系确立好，类与类之间的符号引用转换为直接引用
		- 验证-确保被加载的类的正确性
		- 准备-为类的静态变量分配内存，并将其初始化为默认值
		- 解析-把类中的符号引用转换为直接引用
	- 初始化
静态变量的赋值就是在初始化阶段完成的
		- 为类的静态变量赋予正确的初始值
- 2.提供了更大的灵活性，增加了更多的可能性。
## 2、类加载器ClassLoader
用于加载类的工具，每一个类型都是由类加载器加载到内存中的
- Java虚拟机与程序的生命周期：在如下几种情况下程序将结束生命周期：
	- 执行了System.exit()方法
	- 程序正常执行结束
	- 执行过程中出现异常或者错误而异常终止
	- 由于操作系统出现错误而导致Java虚拟机进程终止
## 3、类的加载、连接与初始化
>> java程序对类的使用有两种方式：
>> - 主动使用
>> - 被动使用

` 所有的Java虚拟机实现必须在每个类或者接口被java程序“首次使用”时才初始化他们`
## 4、主动使用
1. 创建类的实例
2. 访问某个类或者接口的静态变量或者对该静态变量赋值
3. 调用类的静态方法
4. 反射（如Class.forName("com.test.Test")）
5. 初始化一个类的子类
6. Java虚拟机启动时被标记为启动类的类（Java Test或者含有main方法的类）
7. Java1.7开始提供的动态语言支持
## 5、被动使用
除了以上7种主动使用外的使用都是被动使用，被动使用不会导致类的 ***初始化***

## 6、加载
### （1）定义
	类的加载是指将类的class文件中的二进制数据读取到内存中，将其放在运行时数据区的方法区内，然后再内存中创建一个java.lang.Class对象（规范并未说明Class对象位于哪里，HotSpot将其放在了方法区）用来封装类在方法区内的数据结构
### （2）加载.class文件的方式
- 从本地class文件加载
- 从网络下载class文件加载
- 从zip\jar等归档文件中加载.class文件
- 从专有数据库中读取class文件
- 将Java源文件动态编译为class文件（如JSP转换为servlet并被编译为class文件被JVM加载）
	- 动态代理
# 三、JVM参数
实例：-XX:+TraceClassLoading
>> -XX:+<option>    “+”表示开关开启（选项打开）
>> -XX:-<option>    “-”表示开关关闭（选项关闭）
>> -XX:<option>=<value>    表示给选项复制为value

***常量在编译阶段存入调用这个常量的方法所在的类的常量池中，本质上调用类并没有直接应用到定义常量的类，因此并不会触发定义常量的类的初始化***
# 四、

# 五、

# 六、

# 七、

# 八、

# 九、

# 十、

# 十一、

# 十二、

# 十三、